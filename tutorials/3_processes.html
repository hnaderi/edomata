<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Processes</title>
  
  <meta name="author" content="Hossein Naderi"/>
  
  
  <meta name="description" content="docs"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="../icon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/site/laika-helium.css" />
  <script src="../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../introduction.html"><img src="../icon.png"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://github.com/hnaderi/edomata/"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://edomata.ir/"><i class="icofont-laika home" title="Home">&#xef47;</i></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://github.com/hnaderi/edomata/"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://edomata.ir/"><i class="icofont-laika home" title="Home">&#xef47;</i></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../introduction.html">Introduction</a></li>
    <li class="level1 nav-header">about</li>
    <li class="level2 nav-leaf"><a href="../about/features.html">Features</a></li>
    <li class="level2 nav-leaf"><a href="../about/design_goals.html">Design goals</a></li>
    <li class="level1 nav-header">tutorials</li>
    <li class="level2 nav-leaf"><a href="0_getting_started.html">Getting started</a></li>
    <li class="level2 nav-leaf"><a href="1-1_eventsourcing.html">Event sourcing</a></li>
    <li class="level2 nav-leaf"><a href="1-2_cqrs.html">CQRS style</a></li>
    <li class="level2 nav-leaf"><a href="2_backends.html">Running</a></li>
    <li class="level2 active nav-leaf"><a href="#">Processes</a></li>
    <li class="level1 nav-header">principles</li>
    <li class="level2 nav-leaf"><a href="../principles/definitions.html">Definitions</a></li>
    <li class="level2 nav-leaf"><a href="../principles/">Principles</a></li>
    <li class="level1 nav-header">backends</li>
    <li class="level2 nav-leaf"><a href="../backends/skunk.html">Skunk</a></li>
    <li class="level2 nav-leaf"><a href="../backends/doobie.html">Doobie</a></li>
    <li class="level1 nav-header">other</li>
    <li class="level2 nav-leaf"><a href="../other/modules.html">Modules</a></li>
    <li class="level2 nav-leaf"><a href="../other/faq.html">FAQ</a></li>
    <li class="level1 nav-header">Related projects</li>
    <li class="level2 nav-leaf"><a href="https://typelevel.org/cats/">cats</a></li>
    <li class="level2 nav-leaf"><a href="https://typelevel.org/cats-effect/">cats-effect</a></li>
    <li class="level2 nav-leaf"><a href="https://fs2.io/">fs2</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/typelevel/discipline/">discipline</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Processes</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#reading">Reading</a></li>
    <li class="level2 nav-leaf"><a href="#outbox">Outbox</a></li>
    <li class="level2 nav-leaf"><a href="#journal">Journal</a></li>
    <li class="level2 nav-leaf"><a href="#repository">Repository</a></li>
    <li class="level1 nav-leaf"><a href="#integrating">Integrating</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="processes" class="title">Processes</h1>
        
        <h2 id="reading" class="section"><a class="anchor-link left" href="#reading"><i class="icofont-laika link">&#xef71;</i></a>Reading</h2>
        <p>Having a backend at hand from previous chapters like:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">backend</span><span> : </span><span class="type-name">Backend</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Account</span><span>, </span><span class="type-name">Event</span><span>, </span><span class="type-name">Rejection</span><span>, </span><span class="type-name">Notification</span><span>] = ???</span></code></pre>
        
        <h3 id="outbox" class="section"><a class="anchor-link left" href="#outbox"><i class="icofont-laika link">&#xef71;</i></a>Outbox</h3>
        <p>For consuming outboxed items, you can use <code>backend.outbox</code> directly, or you can use the provided <code>OutboxConsumer</code> like the following:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">publisher</span><span> : </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Nothing</span><span>] = </span><span class="type-name">OutboxConsumer</span><span>(</span><span class="identifier">backend</span><span>){ </span><span class="identifier">item</span><span> =&gt;
  </span><span class="comment">// use outboxed item
</span><span>  ???
}</span></code></pre>
        <p><code>OutboxConsumer</code> will consume outboxed items, run the provided action on each of them, marks all items as read.<br>
        It does not handle or recover action failures to simplify error handling on application side.</p>
        <blockquote>Note that outbox pattern is meant for atomically publishing external messages, and while it has useful data in it, it is not meant to be the medium for processing messages like a queue; and it&#39;s best practice to have exactly one consumer on each outbox</blockquote>
        
        <h3 id="journal" class="section"><a class="anchor-link left" href="#journal"><i class="icofont-laika link">&#xef71;</i></a>Journal</h3>
        <p>for reading all journal from the beginning you can use:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">all</span><span> = </span><span class="identifier">backend</span><span>.</span><span class="identifier">journal</span><span>.</span><span class="identifier">readAll</span></code></pre>
        <p>If you are only interested in a single stream, you can use</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">singleStream</span><span> = </span><span class="identifier">backend</span><span>.</span><span class="identifier">journal</span><span>.</span><span class="identifier">readStream</span><span>(</span><span class="string-literal">&quot;interesting-stream&quot;</span><span>)</span></code></pre>
        <p>you can also read before or after a specific sequence number</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">allAfter</span><span> = </span><span class="identifier">backend</span><span>.</span><span class="identifier">journal</span><span>.</span><span class="identifier">readAllAfter</span><span>(</span><span class="number-literal">100</span><span>)
</span><span class="keyword">def</span><span> </span><span class="declaration-name">singleBefore</span><span> = </span><span class="identifier">backend</span><span>.</span><span class="identifier">journal</span><span>.</span><span class="identifier">readStreamBefore</span><span>(</span><span class="string-literal">&quot;interesting-stream&quot;</span><span> ,</span><span class="number-literal">100</span><span>)</span></code></pre>
        
        <h3 id="repository" class="section"><a class="anchor-link left" href="#repository"><i class="icofont-laika link">&#xef71;</i></a>Repository</h3>
        <p>You can read the entire history of a single aggregate root</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">history</span><span> : </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">AggregateState</span><span>[</span><span class="type-name">Account</span><span>, </span><span class="type-name">Event</span><span>, </span><span class="type-name">Rejection</span><span>]] = </span><span class="identifier">backend</span><span>.</span><span class="identifier">repository</span><span>.</span><span class="identifier">history</span><span>(</span><span class="string-literal">&quot;interesting-stream&quot;</span><span>)</span></code></pre>
        
        <h4 id="tip" class="section"><a class="anchor-link left" href="#tip"><i class="icofont-laika link">&#xef71;</i></a>Tip</h4>
        <blockquote>Note that when you read from repository, you get <code>AggregateState</code>, which contains aggregate version on valid streams, or last valid state along with errors and the event that caused this conflict.<br>
        It&#39;s worth noting that your journal are never gonna become corrupt by conflicting decisions, as they are prevented before being written to the journal by conflict protection implemented in Edomata; however if you change 
        the meaning of events, you can change the meaning of history, and face a conflicting stream history.
        It is one of the most important assumptions of event sourcing, that history won&#39;t change its meaning and is not specific to this library, so you should invest in more compatibility testing when you are doing a migration or huge change.</blockquote>
        <p>Or read current state of the write side projection</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">current</span><span> : </span><span class="type-name">IO</span><span>[</span><span class="type-name">AggregateState</span><span>[</span><span class="type-name">Account</span><span>, </span><span class="type-name">Event</span><span>, </span><span class="type-name">Rejection</span><span>]] = </span><span class="identifier">backend</span><span>.</span><span class="identifier">repository</span><span>.</span><span class="identifier">get</span><span>(</span><span class="string-literal">&quot;interesting-stream&quot;</span><span>)</span></code></pre>
        
        <h2 id="integrating" class="section"><a class="anchor-link left" href="#integrating"><i class="icofont-laika link">&#xef71;</i></a>Integrating</h2>
        <p>You can easily use provided streams and read functionality to implement any complex processes or business workflows.<br>
        for example a process manager would be just a possibly stateful stream that handles notifications, 
        or a new custom read side projections would be just another stream that handle journal events.</p>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>